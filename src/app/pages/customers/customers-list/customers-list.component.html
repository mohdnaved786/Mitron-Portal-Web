<main>
  <section class="bg-gray-50 p-4 sm:p-6 md:p-8">
    <div class="container max-w-6xl mx-auto">
      <div class="flex justify-between items-center popins gap-4 mb-3">
        <!-- Left -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-center gap-3">
          <h2 class="text-lg sm:text-xl md:text-2xl font-medium text-gray-900 my-2 sm:my-4 ms-2">
            Customers
          </h2>
        </div>

        <div class="flex items-center  poppins">
          <button
            class=" text-[12px] text-black font-medium uppercase px-4 py-2 border-[#000] border-2 rounded-l-md hover:bg-[#000] hover:text-[#fff] transition ">
            Import
          </button>
          <button
            class=" text-[12px] text-black font-medium uppercase px-4 py-2  border-[#000] border-2 rounded-r-md hover:bg-[#000]  hover:text-[#fff] transition ">
            Export
          </button>
          <button
            class="ms-3 bg-[#000] text-[12px] text-white px-4 py-2.5 rounded-full hover:bg-[#000000cf] transition assign-btn"
            (click)="addCustomer()">
            Add Customer
          </button>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden raleway">
        <!-- Header -->
        <div class="py-3 flex flex-wrap items-center justify-between bg-[#eaeef7] gap-3">
          <div class="flex flex-wrap items-center space-x-2 text-sm text-gray-500 px-4 sm:px-6">
            <span>{{ items.length }} of {{ totalItems }} Customers</span>
            <span class="text-gray-400">|</span>
            <span>No filters applied</span>
          </div>
          <div class="flex items-center space-x-2 w-full sm:w-auto px-4 sm:px-6">
            <div class="relative flex-1 sm:flex-none">
              <input type="text" placeholder="search" [(ngModel)]="searchQuery"
                (input)="filterItems(['name', 'mobile'])"
                class="w-full pl-10 py-[4px] text-sm text-[#7a8ea7] placeholder-[#7a8ea7] border-[1.5px] border-[#7a8ea7] rounded-full focus:outline-none focus:ring-1 focus:ring-[#7a8ea7]" />
              <span
                class="material-symbols-outlined w-4 h-4 text-[#7a8ea7] absolute left-3 top-1/2 transform -translate-y-1/2 text-[20px]">
                search
              </span>
            </div>
            <button
              class="flex items-center justify-center w-10 h-10 text-[#7a8ea7] rounded-full hover:bg-[#7a8ea742] transition-all duration-300 ease-in-out"
              [ngClass]="{
                'bg-[#7a8ea742]': showFilters,
                'hover:bg-[#7a8ea742]': !showFilters
              }" (click)="toggleFilterDropdown()">
              <span class="material-symbols-outlined text-[24px]">filter_alt</span>
            </button>
          </div>
        </div>

        <!-- Inputs Filter slider -->
        <div class="overflow-hidden transition-all duration-500 ease-in-out"
          [style.maxHeight]="showFilters ? '250px' : '0'" [style.opacity]="showFilters ? '1' : '0'">
          <!-- Filter Section -->
          <div
            class="bg-[#eaeef7] px-4 sm:px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row flex-wrap gap-5 transition-all duration-300 ease-in-out">
            <!-- Agent Dropdown -->
            <div class="flex flex-col">
              <label for="agent" class="text-[10px] font-medium text-gray-700 mb-1 uppercase">Country</label>
              <select id="agent" [(ngModel)]="selectedAgent" (change)="applyFilters()"
                class="pe-20 ps-2 py-2 border-none rounded-0 text-xs focus:outline-none focus:ring-1 focus:ring-[#7a8ea7] font-semibold">
                <option value="">All</option>
                <option *ngFor="let agent of agents" [value]="agent">
                  {{ agent }}
                </option>
              </select>
            </div>

            <div class="flex flex-col">
              <label for="agent" class="text-[10px] font-medium text-gray-700 mb-1 uppercase">Member Since</label>
              <select id="agent" [(ngModel)]="selectedAgent" (change)="applyFilters()"
                class="pe-20 ps-2 py-2 border-none rounded-0 text-xs focus:outline-none focus:ring-1 focus:ring-[#7a8ea7] font-semibold">
                <option value="">All</option>
                <option *ngFor="let agent of agents" [value]="agent">
                  {{ agent }}
                </option>
              </select>
            </div>

            <div class="flex flex-col">
              <label for="agent" class="text-[10px] font-medium text-gray-700 mb-1 uppercase">Status</label>
              <select id="agent" [(ngModel)]="selectedAgent" (change)="applyFilters()"
                class="pe-20 ps-2 py-2 border-none rounded-0 text-xs focus:outline-none focus:ring-1 focus:ring-[#7a8ea7] font-semibold">
                <option value="">All</option>
                <option *ngFor="let items of status" [value]="items">
                  {{ items }}
                </option>
              </select>
            </div>

            <!-- From Date -->
            <!-- <div class="flex flex-col">
              <label for="fromDate" class="text-[10px] font-medium text-gray-700 mb-1 uppercase">From Date</label>
              <input type="date" id="fromDate" [(ngModel)]="fromDate" (change)="applyFilters()"
                class="pe-4 ps-2 py-1 border-none rounded-0 text-xs focus:outline-none focus:ring-1 focus:ring-[#7a8ea7] font-semibold" />
            </div> -->

            <!-- To Date -->
            <!-- <div class="flex flex-col">
              <label for="toDate" class="text-[10px] font-medium text-gray-700 mb-1 uppercase">To Date</label>
              <input type="date" id="toDate" [(ngModel)]="toDate" (change)="applyFilters()"
                class="pe-4 ps-2 py-1 border-none rounded-0 text-xs focus:outline-none focus:ring-1 focus:ring-[#7a8ea7] font-semibold" />
            </div> -->
          </div>
        </div>

        <!-- Aâ€“Z Filter Bar -->
        <div class="w-full w-full mb-4">
          <div class="flex w-full">
            <button *ngFor="let letter of alphabet" (click)="filterByLetter(letter)" [ngClass]="{
                'bg-black text-white': selectedLetter === letter,
                'bg-[#7a8ea7] text-white hover:bg-[#b6becd]':
                  selectedLetter !== letter
              }"
              class="flex-1 text-[9px] lg:text-sm sm:font-normal transition-all duration-150 text-center mx-[1px] py-1 transition-all duration-150 me-[0.5px] bg-[#7a8ea7] raleway"
              style="color: white !important">
              {{ letter }}
            </button>
          </div>
        </div>

        <!-- Table (responsive wrapper) -->
        <div class="overflow-x-auto">
          <table class="w-full text-sm leading-none text-left text-gray-500 min-w-[700px]">
            <thead class="text-gray-600 uppercase">
              <tr class="table-header">
                <th scope="col" class="py-3 px-6 cursor-pointer relative left-[60px]"
                  (click)="sortData('name', $event); toggleArrow()" [class.active]="sortColumn === 'name'">
                  <div class="flex items-center gap-1 whitespace-nowrap">
                    Customer Name
                    <svg xmlns="http://www.w3.org/2000/svg"
                      class="w-4 h-4 text-gray-400 transform transition-transform duration-300" [ngClass]="{
                        'rotate-180': isArrowOpen && sortColumn === 'name'
                      }" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                  </div>
                </th>

                <th scope="col" class="py-3 px-6 cursor-pointer"
                  (click)="sortData('country_name', $event); toggleArrow()"
                  [class.active]="sortColumn === 'country_name'">
                  <div class="flex items-center gap-1 whitespace-nowrap">
                    Country
                    <svg xmlns="http://www.w3.org/2000/svg"
                      class="w-4 h-4 text-gray-400 transform transition-transform duration-300" [ngClass]="{
                        'rotate-180': isArrowOpen && sortColumn === 'country_name'
                      }" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                  </div>
                </th>

                <th scope="col" class="py-3 px-6 cursor-pointer" (click)="sortData('mobile', $event); toggleArrow()"
                  [class.active]="sortColumn === 'mobile'">
                  <div class="flex items-center gap-1 whitespace-nowrap">
                    Mobile Number
                    <svg xmlns="http://www.w3.org/2000/svg"
                      class="w-4 h-4 text-gray-400 transform transition-transform duration-300" [ngClass]="{
                        'rotate-180': isArrowOpen && sortColumn === 'mobile'
                      }" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                  </div>
                </th>

                <th scope="col" class="py-3 px-6 cursor-pointer" (click)="sortData('created_at', $event); toggleArrow()"
                  [class.active]="sortColumn === 'created_at'">
                  <div class="flex items-center gap-1 whitespace-nowrap">
                    Member Since
                    <svg xmlns="http://www.w3.org/2000/svg"
                      class="w-4 h-4 text-gray-400 transform transition-transform duration-300" [ngClass]="{
                        'rotate-180': isArrowOpen && sortColumn === 'created_at'
                      }" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                  </div>
                </th>

                <th scope="col" class="py-3 px-6 cursor-pointer"
                  (click)="sortData('last_contacted', $event); toggleArrow()"
                  [class.active]="sortColumn === 'last_contacted'">
                  <div class="flex items-center gap-1 whitespace-nowrap">
                    Last Contacted
                    <svg xmlns="http://www.w3.org/2000/svg"
                      class="w-4 h-4 text-gray-400 transform transition-transform duration-300" [ngClass]="{
                        'rotate-180': isArrowOpen && sortColumn === 'last_contacted'
                      }" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                  </div>
                </th>

                <th scope="col" class="py-3 px-6 cursor-pointer" (click)="sortData('agent_id', $event); toggleArrow()"
                  [class.active]="sortColumn === 'agent_id'">
                  <div class="flex items-center gap-1 whitespace-nowrap">
                    Agent Assigned
                    <svg xmlns="http://www.w3.org/2000/svg"
                      class="w-4 h-4 text-gray-400 transform transition-transform duration-300" [ngClass]="{
                        'rotate-180': isArrowOpen && sortColumn === 'agent_id'
                      }" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <!-- Table body -->
              <tr *ngFor="let customer of items; let i=index " class="bg-white table-row relative">
                <!-- <td>{{i+1}}</td> -->
                <td class="px-6 py-4 font-medium text-gray-900 flex items-center space-x-3">
                  <div class="relative">
                    <div
                      class="w-12 h-12 bg-[#E0E0E0] rounded-full flex-shrink-0 overflow-hidden flex items-center justify-center text-lg font-semibold text-[#A0A0A0] border border-[#A0A0A0]">
                      <ng-container *ngIf="customer.profile_image; else initials">
                        <img [src]="customer.profile_image" alt="" class="w-full h-full object-cover" />
                      </ng-container>
                      <ng-template #initials>
                        {{ getInitialsCustomer(customer.name) }}
                      </ng-template>
                    </div>
                  </div>
                  <div>
                    <span class="wrap-msg" matTooltip="{{ customer.name }}">{{
                      customer.name
                      }}</span>
                  </div>
                </td>
                <td class="px-2 py-4">
                  {{ customer.country_name }} (+{{ customer.country_code }})
                </td>
                <td class="px-6 py-4">{{ customer.mobile }}</td>
                <td class="px-6 py-4">
                  {{ customer.created_at | date : "mediumDate" }}
                </td>

                <td class="px-6 py-4">
                  {{ customer.last_contacted || "-" }}
                </td>

                <td class="px-6 py-4">
                  <span class="px-1 py-0.5 rounded border-[1.5px] bg-[#E5E7EB] text-gray-700">
                    {{ customer.agent_id || "-" }}
                  </span>

                </td>

                <td class="px-6 py-4">
                  <div class="flex items-center">
                    <button class="text-gray-400 hover:text-gray-600 me-3" (click)="openViewReply(customer)">
                      <span class="material-symbols-outlined">chat_bubble</span>
                    </button>

                    <!-- <button class="text-gray-400 hover:text-gray-600">
                                        <span class="material-symbols-outlined">more_vert</span>
                                    </button> -->

                    <button [matMenuTriggerFor]="menu" class="text-gray-400 hover:text-gray-600 focus:outline-none"
                      (click)="toggleOverlay(customer)" s>
                      <span class="material-symbols-outlined">more_vert</span>
                    </button>

                    <!-- Material Menu -->
                    <mat-menu #menu="matMenu" class="custom-menu" xPosition="after" yPosition="below">
                      <button mat-menu-item class="menu-item" (click)="editCustomer(customer)">
                        <mat-icon class="menu-icon">edit</mat-icon>
                        <span>Edit</span>
                      </button>
                      <button mat-menu-item class="menu-item" (click)="openViewCustomerPage(customer.id)">
                        <mat-icon class="menu-icon">visibility</mat-icon>
                        <span>View</span>
                      </button>

                      <button mat-menu-item class="menu-item">
                        <mat-icon class="menu-icon">local_offer</mat-icon>
                        <span>Tags</span>
                      </button>

                      <mat-divider class=""></mat-divider>
                      <button mat-menu-item class="menu-item delete-item" (click)="deleteCustomer(customer)">
                        <mat-icon class="menu-icon">delete</mat-icon>
                        <span>Delete</span>
                      </button>
                    </mat-menu>
                  </div>
                </td>

                <!-- Overlay Gradient -->
                <div *ngIf="customer.showOverlay"
                  class="absolute inset-0 bg-gradient-to-r from-cyan-300 via-green-400 via-yellow-200 to-red-300 opacity-30 pointer-events-none z-0">
                </div>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Footer -->
        <div
          class="px-4 sm:px-6 py-5 flex flex-wrap items-center justify-between border-t border-gray-200 bg-[#eaeef7] gap-3">
          <!-- Items per page -->
          <div class="flex items-center text-sm text-gray-500 space-x-2">
            <span>Items per page:</span>
            <div class="relative">
              <select [(ngModel)]="per_page" (change)="loadData(1)"
                class="p-1 pr-6 rounded-md border-[1.5px] border-[#7d8da4] bg-white text-sm appearance-none">
                <option *ngFor="let option of [10, 20, 50]">
                  {{ option }}
                </option>
              </select>
              <svg
                class="w-4 h-4 text-gray-500 absolute right-1.5 top-1/2 transform -translate-y-1/2 pointer-events-none"
                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
          </div>

          <!-- Pagination -->
          <div class="flex flex-wrap gap-[0.5px] overflow-hidden border-[1.5px] border-[#7d8da4] bg-white rounded-md">
            <!-- First Page -->
            <button class="p-1 bg-[#eaeef7] text-gray-400 hover:bg-[#b6becd] hover:text-white disabled:opacity-50"
              (click)="firstPage()">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7">
                </path>
              </svg>
            </button>

            <!-- Previous Page -->
            <button class="p-1 bg-[#eaeef7] text-gray-500 hover:bg-[#b6becd] hover:text-white" (click)="prevPage()"
              [disabled]="currentPage === 1">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>

            <!-- Page Numbers -->
            <div class="bg-[#eaeef7] flex gap-[0.5px]">
              <button *ngFor="let page of pagination" (click)="typeof page === 'number' && goToPage(page)"
                [disabled]="page === '...' || page === currentPage" [ngClass]="{
                  'bg-[#7a8ea7] text-white': page === currentPage,
                  'bg-white text-gray-500 hover:bg-[#b6becd] hover:text-white':
                    page !== currentPage && page !== '...'
                }" class="px-2 py-1 text-sm font-medium">
                {{ page }}
              </button>
            </div>

            <!-- Next Page -->
            <button class="p-1 bg-[#eaeef7] text-gray-500 hover:bg-[#b6becd] hover:text-white" (click)="nextPage()"
              [disabled]="currentPage === totalPages">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>

            <!-- Last Page -->
            <button class="p-1 bg-[#eaeef7] text-gray-400 hover:bg-[#b6becd] hover:text-white disabled:opacity-50"
              (click)="lastPage()">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7">
                </path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Modal -->
<div *ngIf="selectedItem" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white p-4 rounded-lg shadow-lg max-w-xs w-full relative">
    <button (click)="closeModal()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-[27px]">
      &times;
    </button>
    <p class="text-sm text-gray-700 break-words me-10">
      {{ selectedItem.wa_req_message || "-" }}
    </p>
  </div>
</div>